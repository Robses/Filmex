<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="main.css">
</head>

<body>
    <div id="app">
        <h1 class="center">Filmex</h1>
        <div class="center">
            <label>Podaj tytu≈Ç filmu:</label><br>
            <input id="searchArea" type="text" v-model="searchText" placeholder="Wyszukaj film..." />
            <button id="searchButton" @click="search()">Szukaj</button><br>
            <a>Szukana fraza: {{this.searchText}}</a><br>
        </div>
        <table class="center">
            <tr>
                <th>Podobne filmy</th>
            </tr>
            <tr v-for="movie in movies">
                <td>{{movie}}</td>
            </tr>
        </table>
        <table>
            <h1>Title: {{ this.generalData }}</h1>
        </table>
    </div>
        <!--    <tastedive></tastedive>-->
        <!--     <omdb></omdb>-->
    </div>
</body>

<script src="tastedive.js"></script>
<script src="models/Similar.js"></script>
<script src="models/GeneralData.js"></script>
<script src="omdbapi.js"></script>

<script>
    var app = new Vue({
        el: '#app',
        data: {
            searchText: "",
            movies: [],
            generalData: "",
            errors: []
        },
        computed: {

        },
        methods: {
            search: function() {
                this.searchSimilarMovies();
                this.loadMovieInfo();
            },
            searchSimilarMovies: function() {
                let cors_anywhere_api = 'https://cors-anywhere.herokuapp.com/'
                let tastediveURL = 'https://tastedive.com/api/similar?k=360743-apiclass-HZ7RM425&q=' + this.searchText.toLowerCase()
                let url = cors_anywhere_api + tastediveURL

                axios.get(url).then(response => {
                    similiar = response.data.Similar
                    console.log('Response for: ' + this.searchText.toLowerCase())
                    console.log('Total results: ' + similiar.Results.length)
                
                    filteredResult = similiar.Results.filter(movie => movie.Type === "movie")
                
                    console.log('Total movie results: ' + filteredResult.length)
                
                    filteredResult.forEach(movie => {
                        let item = new Similar(movie.Name, movie.Type);
                        console.log(item)
                        this.movies.push(item)
                    })

                }).catch(e => {
                    console.error(e)
                    this.errors.push(e)
                })
            },

            loadMovieInfo: function() {
                let omdbapiURL = `http://www.omdbapi.com/?t=${this.searchText}&apikey=d3b3f9ef`

                axios.get(omdbapiURL).then(response => {
                    this.generalData = new GeneralData(
                        response.data.Title,
                        response.data.Year,
                        response.data.Rated,
                        response.data.Released,
                        response.data.Runtime,
                        response.data.Genre,
                        response.data.Director,
                        response.data.Writer,
                        response.data.Actors,
                        response.data.Plot,
                        response.data.Language,
                        response.data.Country,
                        response.data.Awards,
                        response.data.Poster,
                        response.data.Ratings,
                        response.data.Metascore,
                        response.data.imdbRating,
                        response.data.imdbID,
                        response.data.Type,
                        response.data.DBD,
                        response.data.BoxOffice,
                        response.data.Production,
                        response.data.Website,
                        response.data.Response
                    )
                    console.log(this.generalData)
                }).catch(e => {
                    console.error(e)
                    this.errors.push(e)
                })
            }
        }
    });

</script>

</html>